import org.jsoup.Jsoup;import org.jsoup.nodes.Document;import org.jsoup.select.Elements;import scala.collection.mutable.ArrayBuffer;/** * MindatScrape * * @author David Krystall *         $ Jan 11 2021 10:52 PM */object MineScrape extends App {  /**   * We use this to Scrape all the link's out of a single page   * @param link A Link on the Mindat site at a locality (ie. https://www.mindat.org/search.php?lo=1&ty=1&search=Maryland%2C+USA)   * @return Gives an array of MindatAnchors, which are the links to all localities in a search.   */  def scrapeLinks(link: String): Array[MindatAnchor] = {    val doc = setDocument(link);    val links = doc.getElementsByTag("a");    var anchors = extractAnchorTag(links);    anchors = anchors.filter(_.contains("loc-"));    convertAnchors(anchors);  };  def scrapeLocality(link: String, yearThresh: Int): Boolean = {    val doc = setDocument(link);    val locRefContent:Option[String] = Some(doc.getElementById("locrefblock").outerHtml);    if(locRefContent.nonEmpty) {      val ref = locRefContent.get;      println(ref);      val numPattern = "[0-9]{4}".r;      val matches = numPattern.findAllIn(ref);      matches.foreach(year => {        if (year.toInt > yearThresh) {          println("Year's new enough");          return true;        }      });    }    false  };  /**   * This uses Jsoup to grab a DOM   * @param url any URL..   * @return returns the DOM   */  private def setDocument(url: String): Document = {    Jsoup.connect(url)      .userAgent("Mozilla/5.0 (Macintosh Intel Mac OS X 11_0) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Safari/605.1.15")      .header("Accept", "text/html,application/xhtml+xml,application/xmlq=0.9,*/*q=0.8")      .header("Host", "www.mindat.org")      .header("Accept-Language", "en-us")      .header("Connection", "keep-al  ive")      .header("Upgrade-Insecure-Requests", "1")      .header("Cookie", "_fbp=fb.1.1602753712137.897028446 _ga=GA1.2.325755022.1602753712 _gid=GA1.2.1914971986.1602753712 ajs_anonymous_id=%222485a5ee-8781-4558-9371-de9a2df9dde1%22 OptanonConsent=isIABGlobal=false&datestamp=Thu+Oct+15+2020+02%3A23%3A33+GMT-0700+(PDT)&version=6.6.0&hosts=&consentId=b1f6083f-5e96-407e-b9a6-d8f1901a07c4&interactionCount=1&landingPath=https%3A%2F%2Fwww.crunchyroll.com%2Fforum&groups=adv%3A1%2Csmv%3A1%2Cven%3A1%2CBG443%3A1%2Cad%3A1%2Csm%3A1%2Creq%3A1 initial_referrer= __utma=91784648.325755022.1602753712.1602753812.1602753812.1 __utmb=91784648.0.10.1602753812 __utmc=91784648 __utmz=91784648.1602753812.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none) usprivacy=1YNN ug=5f8814b00682230a3f961d0014e8b18a ugs=1 __cf_bm=ede30b9ec45dd9d1046b3798bac50a38584c330c-1602753711-1800-AQVyjiOndJrLcda1WaEVmIVEbSJcMOhCnmEl9ij6P56XLAr8hPX/7qTqtw+yxqvJgB8R/GWrx9mmNvJdk1wCsik= __cfduid=d4798f268fec051c3ced240842a87fbf71602753711 c_visitor=2327fc55-bd78-4805-873c-fbc6e4b3578e session_id=b015d25a393c992cbff325ea186d1523 OptanonControl=ccc=US&otvers=&reg=ccpa&pctm=0&vers=3.0.3")      .timeout(30000)      .get();  };  /**   * This takes the subset of Anchors in HTML Elements gathered from the DOM.   * @param links This is basically a huge string of anchor tags   * @return Returns a String array containing the raw Anchor tags (ie. <a href= "somethin">Innter HTML</a>   */  private def extractAnchorTag(links: Elements): Array[String] = {    val linkArray = links.toString.split("\n");    linkArray;  };  /**   * This takes the string of Raw anchors and turns them into our custom type   * @param anchorElements collection of Raw anchor strings   * @return our array of custom Anchors   */  private def convertAnchors(anchorElements: Array[String]): Array[MindatAnchor] = {    val anchorArray = new ArrayBuffer[MindatAnchor]();    for (link <- anchorElements.map {      _.substring(8, 25).split("\">");    }) {      anchorArray.append(MindatAnchor(link(0)));    };    anchorArray.toArray;  };};